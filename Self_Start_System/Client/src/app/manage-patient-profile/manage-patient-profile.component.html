<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '20px', fullScreenBackdrop: true }"></ngx-loading>

<app-navbar-physio></app-navbar-physio>

<div class="container">
	  <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
	<div class="row">
		<div class="col">
			<div class="card-container top">
				<mat-card>
					<div class="row">
						<div class="col-md-8">
							<h1>{{ user.givenName + " " + user.familyName }}</h1>
						</div>
						<div class="col-md-2 col-md-offset-8">
							<div class="icon-bar">
								<mat-icon class="icon" matTooltip="Create Treatment">assignment</mat-icon>
								<mat-icon class="icon" matTooltip="Add Payment">payment</mat-icon>
								<mat-icon class="icon" matTooltip="Send Message">mail outline</mat-icon>
							</div>
						</div>
						<div class="col-md-2 col-md-offset-10">
							<button mat-raised-button class="previous-button" (click)="viewAccountList()">Back to Account List</button>
						</div>
					</div>
					<!-- Tabs -->
					<mat-tab-group>
						<!-- Personal Information -->
						<mat-tab label="Personal Information">
							<form class="form-container">
								<!-- Buttons -->
								<div class="row">
									<div *ngIf="!isChanged; else edit" class="col">
										<div class="col button-container">
											<button mat-raised-button class="edit-button" (click)="editPatientInfo()">Edit</button>
										</div>
									</div>
									<ng-template #edit>
										<div class="col button-container">
											<button mat-raised-button class="cancel-button" (click)="cancelEdit()">Cancel</button>
											<button mat-raised-button class="save-button" (click)="savePatientInfo()">Save</button>
										</div>
									</ng-template>
								</div>
								<!-- Row 1 -->
								<div class="row">
									<div class="col form-container">
										<mat-form-field>
											<input matInput placeholder="Given Name" [(ngModel)]="user.givenName" name="user.givenName" [disabled]="!isChanged">
										</mat-form-field>
									</div>
									<div class="col form-container">
										<mat-form-field>
											<input matInput placeholder="Family Name" [(ngModel)]="user.familyName" name="user.familyName" [disabled]="!isChanged">
										</mat-form-field>
									</div>
								</div>
								<!-- Row 2 -->
								<div class="row">
									<div class="col-4 form-container">
										<mat-form-field>
											<mat-select [(ngModel)]="user.gender" name="user.gender" placeholder="Gender" [disabled]="!isChanged">
												<mat-option *ngFor="let gender of genders" [value]="gender._id">{{gender.name}}</mat-option>
												</mat-select>
										</mat-form-field>
									</div>
									<div class="col-6 form-container">
										<mat-form-field>
											<input matInput [matDatepicker]="picker" placeholder="Date of Birth" [(ngModel)]="user.DOB" name="user.DOB" [disabled]="!isChanged">
											<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
											<mat-datepicker #picker [startAt]="user.DOB"></mat-datepicker>
										</mat-form-field>
									</div>
									<div class="col-2 form-container">
										<mat-form-field>
											<input matInput placeholder="Current Age" [value]="age" [disabled]="!isChanged">
										</mat-form-field>
									</div>
								</div>
								<!-- Row 3 -->
								<div class="row">
									<div class="col-3 form-container">
										<mat-form-field>
											<input matInput placeholder="Street" [(ngModel)]="user.address" name="user.address" [disabled]="!isChanged">
										</mat-form-field>
									</div>
									<div class="col-3 form-container">
										<mat-form-field>
											<input matInput placeholder="City" [(ngModel)]="user.city" name="user.city" [disabled]="!isChanged">
										</mat-form-field>
									</div>
									<div class="col-2 form-container">
										<mat-form-field>
											<mat-select [(ngModel)]="user.province" name="user.province" placeholder="Province" [disabled]="!isChanged">
												 <mat-option *ngFor="let province of provinces" [value]="province._id">{{province.name}}</mat-option>
												</mat-select>
										</mat-form-field>
									</div>
									<div class="col-2 form-container">
										<mat-form-field>
											<input matInput placeholder="Postal Code" [(ngModel)]="user.postalCode" name="user.PostalCode" [disabled]="!isChanged">
										</mat-form-field>
									</div>
									<div class="col-2 form-container">
										<mat-form-field>
											<mat-select [(ngModel)]="user.country" name="user.country" placeholder="Country" [disabled]="!isChanged">
												<mat-option *ngFor="let country of countries" [value]="country._id">{{country.name}}</mat-option>
												</mat-select>
										</mat-form-field>
									</div>
								</div>
								<!-- Row 4 -->
								<div class="row">
									<div class="col-8 form-container">
										<mat-form-field>
											<input matInput placeholder="Email" [(ngModel)]="user.email" name="user.email" [disabled]="!isChanged">
										</mat-form-field>
									</div>
									<div class="col-4 form-container">
										<mat-form-field>
											<input matInput placeholder="Phone Number" [(ngModel)]="user.phone" name="user.phone" [disabled]="!isChanged">
										</mat-form-field>
									</div>
								</div>
							</form>

						</mat-tab>
						<!-- Treatments -->
						<mat-tab label="Treatments">
							<div *ngIf="treatments == 0 else treatmentList" class="empty">
								<h6> {{ user.givenName + " " + user.familyName }} has no treatment history</h6>
							</div>
							<ng-template #treatmentList>
								<div *ngIf="!showPlan else rehabPlan">
									<div class="row top">
										<div class="col">
											<button mat-raised-button class="crete-treatment-button">Create New Treatment</button>
										</div>
									</div>
									<mat-divider></mat-divider>
									<mat-list>
										<mat-list-item *ngFor="let treatment of treatments; let i = index" [attr.data-index]="i" class="treatment" (click)="showRehabPlan(i)">
											<div class="col-3">
												<b>Assignment Date: </b> {{ treatment.dateAssign | date : "dd.MM.y" }}
											</div>
											<div class="col-3">
												<b>Start Date: </b> {{ treatment.dateStart | date : "dd.MM.y" }}
											</div>
											<div class="col-2">
												<b>Active: </b> {{ treatment.active }}
											</div>
											<div class="col-4">
												<b>Rehabilitation Plan: </b> {{ treatment?.rehabilitationPlan?.name }}
											</div>
											<mat-divider></mat-divider>
										</mat-list-item>
										<mat-divider></mat-divider>
								</mat-list>
							</div>
							</ng-template>
							<!-- View to show the details of a specific rehab plan -->
							<ng-template #rehabPlan>
								<form class="form-container">
								<div class="row">
									<div class="col-12 top">
											<button mat-raised-button class="edit-rehab-plan-button" (click)="editRehabPlan()">Edit</button>
										<button mat-raised-button class="back-button" (click)="viewTreatmentList()">Back to Treatment List</button>
									</div>
								</div>
								<form class="form-container">
									<div class="row">
										<div class="col-9 form-container border-right">
											<!-- Treatment Details -->
											<h4><b>Treatment Details</b></h4>
											<hr>
											<div class="row">
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Assigned" [ngModel]="activeTreatment.dateAssign | date : 'dd.MM.y'"name="activeTreatment.dateAssign" readonly>
													</mat-form-field>
												</div>
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Started" [ngModel]="activeTreatment.dateStart | date : 'dd.MM.y'" name="activeTreatment.dateStart" readonly>
													</mat-form-field>
												</div>
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Finished">
													</mat-form-field>
												</div>
											</div>
											<!-- Rehab Plan details -->
											<h4><b>Rehabilitation Plan</b></h4>
											<hr>
											<div class="row">
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Name" [(ngModel)]="activeRehabPlan.name" name="activeRehabPlan.name" readonly>
													</mat-form-field>
												</div>
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Author Name" [(ngModel)]="activeRehabPlan.authorName" name="activeRehabPlan.authorName" readonly>
													</mat-form-field>
												</div>
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Physiotherapist" [value]="physiotherapist" name="physiotherapist">
													</mat-form-field>
												</div>
											</div>
											<div class="row">
												<div class="col-12 form-container">
													<mat-form-field>
														<input matInput placeholder="Description" [(ngModel)]="activeRehabPlan.description" name="activeRehabPlan.description" readonly>
													</mat-form-field>
												</div>
											</div>
											<div class="row">
												<div class="col-8 form-container">
													<mat-form-field>
														<input matInput placeholder="Goal" [(ngModel)]="activeRehabPlan.goal" name="activeRehabPlan.goal" readonly>
													</mat-form-field>
												</div>
												<div class="col-4 form-container">
													<mat-form-field>
														<input matInput placeholder="Time Frame to Complete" [(ngModel)]="activeRehabPlan.timeFrameToComplete" name="activeRehabPlan.timeFrameToComplete" readonly>
													</mat-form-field>
												</div>
											</div>
											<h4><b>Exercises</b></h4>
											<div class="row">
												<div *ngIf="activeRehabPlanExercises.length == 0 else exerciseList">
													<div class="col-12 empty-rehab-plan">
														<h6>No exercises currently.</h6>
													</div>
												</div>
												<ng-template #exerciseList>
													<div class="col-12 form-container">
													<mat-list>
														<mat-divider></mat-divider>
															<mat-list-item *ngFor="let exercise of activeRehabPlanExercises" class="treatment form-container">
																	<div class="col-4 form-container">
																		Name: {{ exercise?.name }}
																	</div>
																	<div class="col-8 form-container">
																		Description: {{ exercise?.description }}
																	</div>
																<mat-divider></mat-divider>
															</mat-list-item>
													</mat-list>
												</div>
												</ng-template>
											</div>
											<h4 class="top"><b>Assesment Tests</b></h4>
											<hr>
											<div class="row">
												<div *ngIf="activeRehabPlanAssessmentTests.length == 0 else asessmentTestList">
													<div class="col-12 empty-rehab-plan">
														<h6>No asessment tests currently.</h6>
													</div>
												</div>
												<ng-template #assessmentTestList>
													<div class="col-12 form-container">
													<mat-list>
														<mat-divider></mat-divider>
															<mat-list-item *ngFor="let assessmentTest of activeRehabPlanAssessmentTests" class="treatment form-container">
																	<div class="col-4 form-container">
																		Name: {{ assessmentTest?.name }}
																	</div>
																	<div class="col-4 form-container">
																		Open Date: {{ assessmentTest?.openDate }}
																	</div>
																	<div class="col-4 form-container">
																		Completed: {{ assessmentTest?.dateCompleted }}
																	</div>
																<mat-divider></mat-divider>
															</mat-list-item>
													</mat-list>
												</div>
												</ng-template>
											</div>
										</div>
										<!-- Rehab plan history -->
										<div class="col-3 form-container">
											<h4>History</h4>
											<hr>
										</div>
									</div>
								</form>
								</form>
							</ng-template>
						</mat-tab>
						<!-- Appointments -->
						<mat-tab label="Appointments">
							<div *ngIf="user.appointments.length == 0 else appointmentList" class="empty">
								<h6> {{ user.givenName + " " + user.familyName }} has no appointment history</h6>
							</div>
							<ng-template #appointmentList>
								<h6 class="top">Appointment history for <i>{{ user.givenName + " " + user.familyName }}</i></h6>
								<mat-divider></mat-divider>
								<mat-list>
									<mat-list-item *ngFor="let appointment of appointments let i = index" [attr.data-index]="i">
										<div class="col-2">
											<b>Date: </b> {{ appointment.date | date : "dd.MM.y" }}
										</div>
										<div class="col-2">
											<b>End Date: </b> {{ appointment.endStart | date : "dd.MM.y" }}
										</div>
										<div class="col-8">
											<b>Reason: </b> {{ appointment.reason }}
										</div>
										<mat-divider></mat-divider>
									</mat-list-item>
								</mat-list>
							</ng-template>
						</mat-tab>
						<!-- Payments -->
						<mat-tab label="Payments">
							<div *ngIf="user.payments.length == 0 else paymentList" class="empty">
								<h6> {{ user.givenName + " " + user.familyName }} has no payment history</h6>
							</div>
							<ng-template #paymentList>
								<h6 class="top">Payment history for <i>{{ user.givenName + " " + user.familyName }}</i></h6>
								<mat-divider></mat-divider>
								<mat-list>
									<mat-list-item *ngFor="let payment of payments let i = index" [attr.data-index]="i">
										<div class="col-2">
											<b>Date: </b> {{ payment.dayTimeStamp | date : "dd.MM.y" }}
										</div>
										<div class="col-2">
											<b>Amount: </b> {{ payment.amount }}
										</div>
										<div class="col-8">
											<b>Note: </b> {{ payment.note }}
										</div>
										<mat-divider></mat-divider>
									</mat-list-item>
								</mat-list>
							</ng-template>
						</mat-tab>
					</mat-tab-group>
				</mat-card>
			</div>
		</div>
	</div>
</div>
