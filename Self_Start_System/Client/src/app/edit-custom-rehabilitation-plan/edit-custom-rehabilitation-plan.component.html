<app-navbar-physio></app-navbar-physio>

<h1 class="title">
  Edit Custom Rehabilitation Plan
  <p style="font-size:16px">
  </p>
</h1>
<mat-tab-group>
    <mat-tab label="Plan Details">
        <br />
        <h1 class="subtitle">
            <b>Plan Details</b>
        </h1>
        <br /><br />
        <div class="plan-details-tab">
            <mat-form-field class="name">
                <input matInput #name placeholder="Name" [(ngModel)]="rehabilitationplan.name">
            </mat-form-field>

            <mat-form-field class="authorName">
                <input matInput #authorName placeholder="Author Name" [(ngModel)]="rehabilitationplan.authorName">
            </mat-form-field>

            <br /><br />

            <mat-form-field class="description">
                <textarea matInput #description placeholder="Description" [(ngModel)]="rehabilitationplan.description"></textarea>
            </mat-form-field>

            <br /><br />

            <mat-form-field class="goal">
                <textarea matInput #goal placeholder="Goal" [(ngModel)]="rehabilitationplan.goal"></textarea>
            </mat-form-field>

            <mat-form-field class="timeframe">
                <textarea matInput #timeframe placeholder="Time Frame To Complete" [(ngModel)]="rehabilitationplan.timeFrameToComplete"></textarea>
            </mat-form-field>
        </div>
    </mat-tab>
    <mat-tab label="Exercises">
        <div class="exercises-tab">
            <br />
            <h1 class="subtitle">
                <b>Exercises</b>
            </h1>
            <br />
            <div class="row">
                <div class="col-6" align="center">
                    <div class="card exercise-card">
                        <div class="card-body">
                            <h3 class="card-title">Available Exercises</h3>
                            <p>Drag an exercise to the other side to add it to the plan.</p>
                            <ul class="list-group list-group-exercise" dnd-sortable-container [sortableData]="allExercises">
                                <!-- Question List -->
                                <li *ngFor="let exercise of allExercises; let i = index" class="list-group-item" dnd-sortable [sortableIndex]="i">
                                    <h6>{{exercise.name}}</h6>
                                    <!-- <p>{{question.questionType}}</p> -->
                                    <!-- <button *ngIf="question.form.length<1" type="button" class="btn btn-danger btn-sm" style="position:absolute; top:4px; right:4px;" (click)="deleteQuestion(question)">Delete</button>
                                    <button *ngIf="question.form.length>=1" type="button" class="btn btn-danger btn-sm disabled" style="position:absolute; top:4px; right:4px;">Delete</button> -->
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-6" align="center">
                    <div class="card exercise-card">
                        <div class="card-body">
                            <h3 class="card-title">Exercises in this Plan </h3>
                            <p>Drag to re-order or remove exercises from the rehabilitation plan.</p>
                            <ul class="list-group list-group-exercise" dnd-sortable-container [sortableData]="myExercises">
                                <!-- Question List -->
                                <li *ngFor="let exercise of myExercises; let i = index" class="list-group-item" dnd-sortable [sortableIndex]="i">
                                    <h6>{{exercise.name}}</h6>
                                    <!-- <p>{{question.questionType}}</p> -->
                                    <button type="button" class="btn btn-light btn-sm" style="position:absolute; top:4px; right:4px;" (click)="openEditExerciseDialog(exercise)">Edit</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </mat-tab>
    <mat-tab label="Assigned Assessments">
    <br>
      <div class="container top">
        <div class="row">
          <div class="col-12">
            <mat-card style="height: auto; width: auto;">
              <h2>Assigned Tests
                <button mat-raised-button class="yellowButton" (click)="createAssessmentTest()" style="float: right">Create New Assessment Test</button>
              </h2>
              <hr>
              <div class="row">
                <div class="col-md-3 border-right" style="padding: 0%;">
                  <mat-list class="test-list">
                    <h5>Tests</h5>
                    <mat-divider></mat-divider>
                    <mat-list-item class="item" [ngClass]="{'selectedIncompleteTest': selectedIncompleteIndex == i}" *ngFor="let test of incompleteAssessmentTests; let i = index" [attr.data-index]="i" (click)="setActiveIncompleteTest(i)" >
                      <h6>{{test.name}}</h6>
                    </mat-list-item>
                    <mat-divider></mat-divider>
                  </mat-list>
                </div>
                <div class="col-md-9 col-md-offset-3">
                  <!-- Row 1 -->
                  <div class="row">
                    <div class="col-4 form-container">
                      <mat-form-field style="width: 100%;">
                        <input matInput placeholder="Test Name" [(ngModel)]="incompleteAssessmentTests[selectedIncompleteIndex].name">
                      </mat-form-field>
                    </div>
                    <div class="col-4 form-container">
                      <mat-form-field style="width: 100%;">
                        <input matInput placeholder="Author" [(ngModel)]="incompleteAssessmentTests[selectedIncompleteIndex].authorName">
                      </mat-form-field>
                    </div>
                    <div class="col-4 form-container">
                      <mat-form-field style="width: 100%;">
                        <input matInput [(ngModel)]="incompleteAssessmentTests[selectedIncompleteIndex].openDate" [matDatepicker]="picker" placeholder="Open Date">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                      </mat-form-field>
                    </div>
                  </div>
                  <!-- Row 2 -->
                  <div class="row">
                    <div class="col-12 form-container">
                      <mat-form-field style="width: 100%;">
                        <input matInput placeholder="Description" [(ngModel)]="incompleteAssessmentTests[selectedIncompleteIndex].description">
                      </mat-form-field>
                    </div>
                  </div>
                  <!-- Row 3: Questions -->
                  <div class="row">
                    <div class="col-12 form-container">
                      <h6>Questions: Drag to re-order.</h6>
                      <ul class="list-group-questions" dnd-sortable-container [sortableData]="formQuestions">
                        <!-- Question List -->
                        <li *ngFor="let question of formQuestions; let i = index" class="list-group-item" dnd-sortable [sortableIndex]="i">
                          <h6>{{i+1}}. {{question.questionText}}</h6>
                          <p>{{question.questionType}}</p>
                          <button type="button" class="btn btn-light btn-sm" style="position:absolute; top:4px; right:4px;" (click)="openEditQuestionDialog(question)">Edit</button>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card>
          </div>
        </div>
      </div>
      <!--<div class="row">-->
        <!--<div class="col-12">-->
          <!--<div class="card">-->
            <!--<div class="card-body">-->
              <!--<p *ngIf="incompleteAssessmentTests.length == 0">There are no pending tests created for this Rehabilitation Plan.</p>-->
                <!--<li *ngFor="let test of incompleteAssessmentTests" class="list-group-item">-->
                  <!--<h5>{{test.name}}</h5>-->
                  <!--<p>Open Date: {{test.openDate | date:'fullDate'}}</p>-->
                  <!--<button type="button" class="btn btn-light btn-sm yellowButton" style="position:absolute; top:4px; right:4px;" (click)="openEditAssessmentTestDialog(test, false)">Edit</button>-->
                  <!--<button type="button" class="btn btn-danger btn-sm" style="position:absolute; top:38px; right:4px;" (click)="deleteAssessmentTest(test)">Delete</button>-->
                <!--</li>-->
            <!--</div>-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
  </mat-tab>
    <mat-tab label="Completed Assessments">
    <br>
    <h1 class="subtitle">
      <b>Completed Assessments</b>
      <br>
    </h1>
    <br>
    <div class="container">
      <div class="row">
        <div class="col-4" >
          <div class="card">
            <p *ngIf="completeAssessmentTests.length == 0">There are no tests created for this Rehabilitation Plan.</p>
            <ul class="list-group" >
              <li *ngFor="let test of completeAssessmentTests" class="selectedTest list-group-item" (click)="selectCompleteAssessmentTest(test)">
                <p *ngIf="test == selectedCompleteAssessmentTest">VIEWING</p>
                <h5>{{test.name}}</h5>
                <p>Date Completed: {{test.dateCompleted | date:'fullDate'}}</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-8">
          <div class="row">
            <div class="col-12">
              <div class="card">
                <h1 class="subtitle">
                <b>Test Results</b>
                </h1>
                <br>
                <div class="">
                  <p *ngIf="!selectedCompleteAssessmentTest">Select an Assessment Test to view the responses.</p>
                  <ul class="list-group-ans">
                    <li *ngFor="let result of allResults" class="list-group-item">
                      <p>Question: {{result.question}}</p>
                      <p>Answer: {{result.answer}}</p>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <h1 class="subtitle">
                  <b>Recommendations</b>
                  <br>
                  <button *ngIf="selectedCompleteAssessmentTest" mat-raised-button class="yellowButton" (click)="createRecommendation()">Add New Recommendation</button>
                </h1>
                <br>
                <p *ngIf="!selectedCompleteAssessmentTest">Select an Assessment Test to view or add a recommendation.</p>
                <ul class="list-group-reco">
                  <li *ngFor="let recommendation of selectedAssessmentRecommendations" class="selectedRecommendation list-group-item" (click)="openEditRecommendationDialog(recommendation)">
                    <p>{{recommendation.decision}}</p>
                    <p>Last Edited: {{recommendation.timeStamp | date:'fullDate'}}</p>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
<br />

<br />
<br />

<button mat-raised-button class="stickToBottom" routerLink="/rehabilitation-plan" (click) = "putRehabilitationPlan(name.value, description.value, authorName.value, goal.value, timeframe.value)">SAVE CHANGES</button>
